ALYNT CERTIFICATE GENERATOR â€” SETUP NOTES (Windows / PowerShell)
==============================================================

This file documents the issues encountered while running:
  - composer install
  - npm install
  - npm run build
  - vendor/bin/phpunit

...and the exact steps used to fix them, so you can reuse this for future plugins.


1) PowerShell command chaining (&&)
----------------------------------
Issue:
  PowerShell on this machine did not accept "&&" as a statement separator.

Fix:
  Use ";" to separate commands in PowerShell, e.g.:
    cd "C:\Path\To\Plugin"; php composer.phar install


2) Composer not installed / not in PATH
---------------------------------------
Issue:
  Running "composer install" failed with:
    "composer : The term 'composer' is not recognized..."

Fix:
  Downloaded Composer PHAR into the project directory and ran it via PHP:
    cd "C:\Development\WordPress\Plugins\alynt-certificates-generator"
    Invoke-WebRequest -Uri "https://getcomposer.org/download/latest-stable/composer.phar" -OutFile "composer.phar"
    php composer.phar install

Note:
  You can also install Composer globally, but using composer.phar is a reliable per-project approach.


3) Composer failed: OpenSSL extension missing (and no php.ini loaded)
---------------------------------------------------------------------
Issue:
  Composer failed with:
    "The openssl extension is required for SSL/TLS protection but is not available."

We confirmed:
  php -i showed:
    Loaded Configuration File => (none)

Fix:
  Created a php.ini for the CLI PHP, then enabled needed extensions.

Steps used:
  1) Find PHP directory (on this machine it was C:\php):
       (Get-Command php).Source

  2) Create php.ini from the bundled template:
       Copy-Item "C:\php\php.ini-development" "C:\php\php.ini"

  3) Enable extensions by uncommenting these lines in C:\php\php.ini:
       extension=openssl
       extension=curl
       extension=gd
       extension=mbstring
       extension=zip

     (We did this via a PowerShell replace, but editing manually is fine.)

  4) Verify extensions are enabled:
       php -m | Select-String -Pattern "openssl|curl|gd|mbstring|zip"

After that, Composer could connect to Packagist and download packages normally.


4) Composer plugin blocked (allow-plugins)
------------------------------------------
Issue:
  Composer halted with:
    "dealerdirect/phpcodesniffer-composer-installer contains a Composer plugin which is blocked by your allow-plugins config."

Fix:
  Allowed the plugin:
    cd "C:\Development\WordPress\Plugins\alynt-certificates-generator"
    php composer.phar config allow-plugins.dealerdirect/phpcodesniffer-composer-installer true

Then re-ran:
    php composer.phar install


5) Composer slow downloads / zip + unzip
----------------------------------------
Issue:
  Composer reported missing zip extension and unzip/7z, and tried to fall back to "source" installs.

Fix:
  Enabled the PHP "zip" extension in php.ini (see section 3), then re-ran:
    php composer.phar install


6) npm install / npm run build
------------------------------
Commands run:
  cd "C:\Development\WordPress\Plugins\alynt-certificates-generator"
  npm install
  npm run build

Notes:
  - npm install completed, but reported 1 moderate vulnerability.
    This did NOT block the build.
  - Build completed successfully and output went to:
      assets/dist/


7) PHPUnit run + test fixes
---------------------------
Command run:
  cd "C:\Development\WordPress\Plugins\alynt-certificates-generator"
  ./vendor/bin/phpunit

Issues encountered and fixes:

  A) Brain Monkey returnArg index
     - Brain Monkey's returnArg() expects a 1-based argument index, not 0.
     - Fixed tests that used returnArg(0) to use returnArg(1).

  B) Plugin classes not autoloading in tests
     - Vendor autoload alone does not know about plugin classes because we used a custom loader.
     - Fixed by registering the plugin autoloader in tests/bootstrap.php:
         require_once dirname(__DIR__) . '/includes/class-loader.php';
         new Alynt\CertificateGenerator\Alynt_Certificate_Generator_Loader(dirname(__DIR__));

  C) Mocking internal functions (hash_equals)
     - Attempting to monkey-patch internal functions caused Patchwork errors.
     - Fixed by removing the hash_equals mock from the test.

  D) Missing WP helper stubs
     - The webhook test required esc_url_raw().
     - Fixed by stubbing esc_url_raw via Brain Monkey in the test.

Result:
  PHPUnit passed:
    OK (3 tests, 6 assertions)


8) Optional housekeeping for future plugins
-------------------------------------------
  - Keep composer.phar out of git:
      Added to .gitignore: /composer.phar
  - Consider installing Composer globally and ensuring PHP has a proper php.ini with openssl/curl/zip enabled.

